<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;application/json; charset=UTF-8" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>epos188</title>
    <script src="jquery-3.1.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
var socket = io("https://epos188.herokuapp.com/");
socket.connect();
var map;
var mangmarker = [];
var marker1 = {};
var list_nguoinhan = [];
var list_diem_gui_di = [];
var id_posname=1;
var mang_infowindow = [];
var mang_infowindow_main = [];
var ten="";
var mang_kq_contact_search = [];
var id_mang_kq_contact_search=0;
var mang_contact_ok = [];
var id_mang_contact_ok=0;
var check_del = true;
var number_del_inbox = 0; // biến này để đếm số lượng đã chọn trong các mục để xóa
function strdecode( data ) {
  return decodeURIComponent(escape( data ));
}
var id_inbox_pos=0;
var id_contact = 0;
var mang_inbox = [];
var mang_send = [];
var mang_save = [];
var mang_contact = [];
var mang_contact_ok = [];
var mang_room = [];
var list_del_inbox = [];
var list_del_send = [];
var list_del_save = [];
var list_del_online = [];
let mafull="";
let cru_online=0;
let cru_inbox = 0;
let cru_send = 0;
let cru_save=0;
let cru_contact = 0;
let cru_group = 0;
var room_name_chose="";
var abc = 1;
var timer = setInterval(check_online, 3000);
let ab;
function check_online(){
  if(mang_infowindow_main.length>0){
    mang_infowindow_main.forEach((row)=>{
      if(document.getElementById("li_lo"+row.id).style.color == "white"){
        row.dem ++ ;
        if(row.dem > 2){
          document.getElementById("li_lo"+row.id).style.color= "black";
          for (var i=0; i<mang_infowindow.length; i++){
              if(mang_infowindow[i].id == row.id){
                mang_infowindow[i].wind.close();
                mang_infowindow.splice(i,1);
                return false;
              }
            }

      }
      }
    });
  }
}

socket.on('S_W_kq_check_contact',(data)=>{
      var dropdowns = document.getElementsByClassName("list_contact_1");
      var k;
      for (k = 0; k < dropdowns.length; k++) {
      var openDropdown = dropdowns[k];
      if (!(openDropdown.classList.contains('show1'))) {
       document.getElementById("my_list_contact").classList.toggle("show1");
      }
      }

    });
socket.on('S_send_room_member', function(data){
                    var ten ="";

                    data.forEach(function(member){
                      ten = ten+ "<a href='#' onclick='show_vitri_thanhvien("+member.number+");'>"+member.name + "</a>";
                      });

                      $("#myDropdown6").html( ten);
                  });
socket.on('S_send_send', (row)=>{
     //S gửi toàn bộ bản tin send về client
     cru_send = row.ids;
       var thoigian="";
         var ab = "";
         var space = "";
         id_inbox_pos++;
         var idc = "3"+id_inbox_pos;
         var tin = {ids: row.ids,id_pos:idc, nhom_nguoinhan:row.nguoinhan, subject:strdecode(row.subject), id_tinnha_client:row.idc, thoigian:show_time(row.time) };
         mang_send.push(tin);
         row.nguoinhan.forEach((row1,key)=>{
              if(key===(row.nguoinhan.length-1)){space="";}else {space=" ,";}
              if(row1.stt ==="N"){ab=ab+"<font color='red'>"+strdecode(row1.name)+"</font>" +space;}else {ab=ab+strdecode(row1.name)+space;}
          });
          var line = '<div class="line_inbox" id="send'+idc+'"><input type="checkbox" id="'+idc+'" class="line_send_chk" onclick="checkbox_send_click('+idc+')"><div class="line_send_main" onClick="send_click(\'' + row.idc+ '\',\''+strdecode(row.subject)+'\')"><div class="line_send_sub">'+strdecode(row.subject)+'</div><div class="line_send_time">'+show_time(row.time)+'</div><div class="line_send_from">To:'+ab+'</div><div class="line_send_read">ha ha</div></div></div>';
          $("#k_send").prepend(line);

});
socket.on('S_send_save', (row)=>{
     //S gửi toàn bộ bản tin inbox về client
     cru_save = row.ids;
         var thoigian="";
         id_inbox_pos++;
         var idc = "2"+id_inbox_pos;
         var tin = {ids: row.ids,id_pos:idc, subject:strdecode(row.subject), id_tinnha_client:row.idc, time:show_time(row.time) };
         mang_save.push(tin);
        var line = '<div class="line_inbox"><input type="checkbox" id="'+idc+'" class="line_save_chk" onclick="checkbox_save_click('+idc+')"><div class="line_save_main" onClick="save_click(\'' + row.idc+ '\',\''+strdecode(row.subject)+'\')"><div class="line_save_sub">'+strdecode(row.subject)+'</div><div class="line_inbox_time">'+show_time(row.time)+'</div></div></div>';
          $("#k_save").before(line);
});
socket.on('S_send_contact',(tin)=>{
  cru_contact = tin.ids;
    id_contact ++;
    var idc = "1"+id_contact;
    mang_contact.push({ids: tin.ids,id: idc, name: tin.name, number:tin.number});
    var line = "<div class='list_contact_main_line'><div class='abc'><div class='list_contact_line_name' id='list_contact_name'>"+strdecode(tin.name)+"</div><div class='list_contact_line_number' id='list_contact_number'>"+tin.number+"</div><button class='list_contact_line_btn' id='btn"+idc+"' onclick='add_contact_click("+idc+")'>Add</button></div></div>";
      $("#id_list_contact").append(line);
});
socket.on('S_send_room',(data)=>{
  id_inbox_pos++;
  cru_online = data.ids;
  var idc = "5"+id_inbox_pos;
  var tin = {ids: data.ids,id_pos:idc, name_nguoigui:strdecode(data.admin_name),number_nguoigui:data.admin_number, subject:strdecode(data.room_name), room_id:data.room_id_server, thoigian:show_time(data.time)};
  mang_room.push(tin);
  var line = '<div class="line_inbox" id="room'+idc+'"><input type="checkbox" id="'+idc+'" class="line_online_chk" onclick="checkbox_online_click('+idc+');"><div class="line_inbox_main" onClick="online_clk(\'' + data.room_id_server + '\',\''+strdecode(data.room_name)+'\')"><div class="line_inbox_sub">'+strdecode(data.room_name)+'</div><div class="line_inbox_time">'+show_time(data.time)+'</div><div class="line_inbox_from">From:'+strdecode(data.admin_name)+'</div><div class="line_inbox_read"></div></div></div>';
  $("#k_online").prepend(line);
  if(data.stt=="F"){socket.emit('danhan_room',data.room_id_server);}
});
socket.on('S_send_member',(tins)=>{
  if(mang_infowindow_main.length >0){
  for (var i=(mang_infowindow_main.length-1); i>=0; i--){
    if(mang_infowindow_main[i].online ==='O'){
      document.getElementById("li_lo"+mang_infowindow_main[i].id).remove();
      for (var k=(mang_infowindow.length-1); k>=0; k--){
        if(mang_infowindow[k].id===mang_infowindow_main[i].id){
          mang_infowindow.splice(k,1);
          return false;
        }
      }
        mang_infowindow_main.splice(i,1);
    }
    if(i===0 ){
        tins.forEach((tin,key)=>{
          mang_infowindow_main.push({name:strdecode(tin.name),lat:null,lon:null,id:tin.number, online:'O', dem:0});
          var line = '<div class="list_line_member" id="li_lo'+tin.number+'"><div class="lo_list_sub" onclick="fly_to('+tin.number+')">'+strdecode(tin.name)+'</div><input type="checkbox" class="list_line_checkbox" id="chk'+tin.number+'" onchange="hide_show_pos('+tin.number+')"><div class="lo_list_show">Hide</div></div>';
          $("#id_location_list").append(line);
        });
      }
    }
  }
  else {
  tins.forEach((tin,key)=>{
    mang_infowindow_main.push({name:strdecode(tin.name),lat:null,lon:null,id:tin.number, online:'O',dem:0});
    var line = "<div class='list_line_member' id='li_lo"+tin.number+"'><div class='lo_list_sub' onclick='fly_to("+tin.number+")'>"+strdecode(tin.name)+"</div><input type='checkbox' class='list_line_checkbox' id='chk"+tin.number+"' onchange='hide_show_pos("+tin.number+")'><div class='lo_list_show'>Hide</div></div>";
    $("#id_location_list").append(line);
    });
  }
});
socket.on('S_W_add_friend_ok',function(data){
              var new_contact = "<a href=''>"+data.name+"</a></br>";
             $("#myDropdown_contact").append(new_contact);
             var stt = mang_contact_ok.length;
             mang_contact_ok.push({id:data.id,number:data.number, name:data.name});
          });
socket.on('S_del_inbox',()=>{
    document.getElementById("id_content_inbox_del").style.display = "none";
    list_del_inbox.forEach((row, key)=>{
      for(var i=0; i< mang_inbox.length; i++){
        if(mang_inbox[i].id_tinnha_client===row.idc){
          document.getElementById("inbox"+mang_inbox[i].id_pos).remove();
          mang_inbox.splice(i,1);
          if(key===list_del_inbox.length){list_del_inbox= [];}
          return false;
        }
      }
    });
    // bỏ cái hàng với cái id kia
    // document.getElementById(id1).remove();
    alert('Tin nhắn đã được xóa thành công');
});
socket.on('S_del_online',()=>{
  document.getElementById("id_content_online_del").style.display = "none";
  list_del_online.forEach((row, key)=>{
    for(var i=0; i< mang_room.length; i++){
      if(mang_room[i].room_id===row.idc){
        console.log("online"+mang_room[i].id_pos);
        document.getElementById("room"+mang_room[i].id_pos).remove();
        mang_room.splice(i,1);
        if(key===list_del_online.length){list_del_online= [];}
        return false;
      }
    }
  });
  // bỏ cái hàng với cái id kia
  // document.getElementById(id1).remove();
  alert('Tin nhắn đã được xóa thành công');
});
socket.on('S_del_send',()=>{
  document.getElementById("id_content_send_del").style.display = "none";
  list_del_send.forEach((row, key)=>{
    for(var i=0; i< mang_send.length; i++){
      if(mang_send[i].id_tinnha_client===row.idc){
        document.getElementById("send"+mang_send[i].id_pos).remove();
        mang_send.splice(i,1);
        if(key===list_del_send.length){list_del_send= [];}
        return false;
      }
    }
  });

  alert('Tin nhắn đã được xóa thành công');
});
socket.on('S_guitinnhan',(data)=>{
  id_inbox_pos++;
  var idc = "4"+id_inbox_pos;
  var tin = {id_pos:idc, name_nguoigui:strdecode(data.name_nguoigui),number_nguoigui:data.number_nguoigui, subject:strdecode(data.subject), id_tinnha_client:data.id_tinnha_client,trangthai:"N", thoigian:show_time(data.time) };
  mang_inbox.push(tin);
  var stt = data.stt;
  if(stt!= null && stt==("N")){socket.emit("danhantinnhan",data.number_nguoigui,data.id_tinnha_client);}
  var line = '<div class="line_inbox"><input type="checkbox" id="'+idc+'" class="line_inbox_chk" onclick="checkbox_inbox_click('+idc+')"><div class="line_inbox_main" onClick="inbox_click(\'' + data.id_tinnha_client+ '\',\''+strdecode(data.subject)+'\')"><div class="line_inbox_sub">'+strdecode(data.subject)+'</div><div class="line_inbox_time">'+show_time(data.time)+'</div><div class="line_inbox_from">From:'+strdecode(data.name_nguoigui)+'</div><div class="line_inbox_read">'+'Not read'+'</div></div></div>';
  $("#k_inbox").prepend(line);

});
socket.on('S_get_save_pos', (abc,data)=>{
  // abc,{time:get_time(thoigian),subject:strencode(mess.subject),idc:mess.idc}
  id_inbox_pos++;
  var idc = "2"+id_inbox_pos;
  var tin = {id_pos:idc, subject:strdecode(data.subject), id_tinnha_client:data.idc, time:show_time(data.time) };
  mang_save.push(tin);
  var line = "<div class='line_inbox' id='save"+idc+"' ><input type='checkbox' id='"+idc+"' class='line_inbox_chk' onclick='checkbox_save_click("+idc+");'><div class='line_inbox_main' onclick='save_click("+idc+")'><div class='line_save_sub'>"+strdecode(data.subject)+"</div><div class='line_inbox_time'>"+show_time(data.time)+"</div></div></div>";
 $("#k_save").prepend(line);
  socket.emit("C_get_save_mes", "web",data.idc);
});
socket.on('S_get_tinnhan',(C_mei, data)=>{
  if(C_mei===mafull){
    document.getElementById("id_input_subject").value="";
    mang_contact_ok.forEach((row,key)=>{
      $("#btn"+row.id).html("Add");
      if(key===(mang_contact_ok.length-1)){mang_contact_ok=[];}
  });
    $("#id_list_contact_ok").html("");
    alert('Sending location successfully');
  }
  // {ids:res.insertId, subject:strencode(mess.subject),nguoinhan:nguoinhans,idc:mess.id,time:get_time(thoigian)});
  id_inbox_pos++;
  var ab = "";
  var space = "";
  var idc = "3"+id_inbox_pos;
  var tin = {id_pos:idc, nhom_nguoinhan:data.nguoinhan, subject:strdecode(data.subject), id_tinnha_client:data.idc, thoigian:show_time(data.time) };
  mang_send.push(tin);
  data.nguoinhan.forEach((row1,key)=>{
     if(key===(data.nguoinhan.length-1)){space="";}
     else {space = ";";}
     ab=ab+"<font color='red'>"+strdecode(row1.name)+"</font>" +space;
   });
  var line = "<div class='line_inbox' id='send"+idc+"'><input type='checkbox' id='"+idc+"' class='line_send_chk' onclick='checkbox_send_click("+idc+");'><div class='line_send_main' onclick='send_click("+idc+")'><div class='line_send_sub'>"+strdecode(data.subject)+"</div><div class='line_send_time'>"+show_time(data.time)+"</div><div class='line_send_from'>To:"+ab+"</div><div class='line_send_read'></div></div></div>";
   $("#k_send").prepend(line);
});
socket.on('C_danhantinnhan',(data)=>{
  mang_send.forEach((tin)=>{
    if(tin.id_tinnha_client ===data.idc){
      let ab = "";
      let space="";
      tin.nhom_nguoinhan.forEach((row,key)=>{
         if(key===(tin.nhom_nguoinhan.length-1)){space="";}else {space = "; ";}
         if(row.number === data.nguoinhan){ab=ab+strdecode(row.name)+space;row.stt='Y';}
         else {
           if(row.stt ==='N'){ab=ab+"<font color='red'>"+strdecode(row.name)+"</font>" +space;}
           else {ab=ab+strdecode(row.name)+space;}

         }
      });
      var line = "<div class='line_inbox' id='send"+tin.id_pos+"'><input type='checkbox' id='"+tin.id_pos+"' class='line_send_chk' onclick='checkbox_send_click("+tin.id_pos+");'><div class='line_send_main' onclick='send_click("+tin.id_pos+")'><div class='line_send_sub'>"+strdecode(tin.subject)+"</div><div class='line_send_time'>"+tin.thoigian+"</div><div class='line_send_from'>To:"+ab+"</div><div class='line_send_read'></div></div></div>";
      $("#send"+tin.id_pos).html(line);
      return false;
    }
  });
  // chuyển đổi màu sắc sang đỏ đối với người

});
function online_clk(room,name){
  socket.on('S_get_join',()=>{
    document.getElementById("id_online_text").style.display = "block";
    $("#id_input_subject").val(room_name_chose);
      socket.off('S_get_join');
      socket.on('S_pos_online',(data)=>{
        mang_infowindow_main.forEach((tin)=>{
          if(tin.online==='O' && tin.id === data.number){
            let name1 = tin.name;
            let id1 = tin.id;
            tin.lat = data.lat;
            tin.lon = data.lon;
            tin.dem = 0;
            document.getElementById("li_lo"+tin.id).style.color= "white";
            if(mang_infowindow.length >0){
              var check=true;
              mang_infowindow.forEach((row,key)=>{
                if(row.id === tin.id && row.wind != null){
                  check= false;
                  var latlng = new google.maps.LatLng(data.lat, data.lon);
                  row.wind.setPosition(latlng);
                  return false;
                }
                if(key===(mang_infowindow.length-1) && check ){
                  let chuoi = "<div class='icon_live'>"+tin.name+"</div>";
                  var infow = new google.maps.InfoWindow({
                    position:{ lat:data.lat, lng: data.lon},
                    content:chuoi,
                    disableAutoPan : true
                  });
                  mang_infowindow.push({id:id1,wind:infow});
                  infow.open(map);
                  google.maps.event.addListener(infow,'closeclick',function(){
                for (var i=0; i<mang_infowindow.length; i++){
                    if(mang_infowindow[i].id == id1){
                      mang_infowindow.splice(i,1);
                      break;
                    }
                  }
                });
              }
              });
            }
            else {
              let chuoi = "<div class='icon_live'>"+tin.name+"</div>";
              var infow = new google.maps.InfoWindow({
                position:{ lat:data.lat, lng: data.lon},
                content:chuoi,
                disableAutoPan: true
              });
              mang_infowindow.push({id:tin.id,wind:infow});
              infow.open(map);
              google.maps.event.addListener(infow,'closeclick',function(){
              for (var i=0; i<mang_infowindow.length; i++){
                  if(mang_infowindow[i].id == id1){
                    mang_infowindow.splice(i,1);
                    break;
                  }
                }
              });
            }
            return false;
          }
        });
      });
    });
  socket.emit('C_join_room',room);
  room_name_chose =name;
}
function speak_loud(noi_dung){
  var msg = new SpeechSynthesisUtterance(noi_dung);
  window.speechSynthesis.speak(msg);
}
function kiemtra(){
  // var url = "https://translate.google.com/translate_tts?ie=utf-8&q="+hihi+"&tl=en";
  // $("audio").attr('src', url).get(0).play();
  if(document.getElementById("btn_sw_map").innerHTML =="Map"){
    document.getElementById("btn_sw_map").innerHTML = "Satelite";
    map.setMapTypeId(google.maps.MapTypeId.ROADMAP);
  }
  else {
    document.getElementById("btn_sw_map").innerHTML = "Map";
    map.setMapTypeId(google.maps.MapTypeId.HYBRID);
  }
}
function hide_show_pos(id){
  if(document.getElementById("chk"+id).checked == true){cancle_luudiem(id);}
  else {
    for (var i=0; i<mang_infowindow_main.length; i++){
      if(mang_infowindow_main[i].id ==id){
        var lat1 = mang_infowindow_main[i].lat;
        var lon1 = mang_infowindow_main[i].lon;
        let name1 = "<div class='icon'>"+mang_infowindow_main[i].name+"</div>";
        // var name1 = mang_infowindow_main[i].name;
        var infowindow = new google.maps.InfoWindow({
            position:{ lat:lat1, lng:lon1},
            content:name1
        });
          // infowindow.setContent(name1);
          infowindow.open(map);
          var win = {id:id, wind: infowindow};
          mang_infowindow.push(win);
          google.maps.event.addListener(infowindow, 'closeclick', function() {
            document.getElementById("li_lo"+id).remove();
            for(var i=0; i<mang_infowindow.length; i++){
              if(mang_infowindow[i].id == id){
                mang_infowindow.splice(i,1);
                break;
              }
            }
            for(var i=0; i<mang_infowindow_main.length; i++){
              if(mang_infowindow_main[i].id == id){
                mang_infowindow_main.splice(i,1);
                break;
              }
            }

          });
      break;
        }
      }
  }
}
function show_pos(lat,lon, name, id1,stt){
  let chuoi;
  let abc='pos'+id1;
  if(name.length >5){chuoi = '<div align="center" id="'+abc+'" class="icon" onclick="modify_name('+id1+')" onmousemove="onmouse_pos('+id1+',event)" onmouseout="onmouse_out()">'+name+'</div>';}
  else {
    chuoi = '<div align="center" id="'+abc+'" class="icon2" onclick="modify_name('+id1+')" onmouseover="onmouse_pos('+id1+',event)" onmouseout="onmouse_out()">'+name+'</div>';
  }
  var infow = new google.maps.InfoWindow({
      position:{ lat:lat, lng: lon},
      content:chuoi,
    });
    mang_infowindow_main.push({name:name,lat:lat,lon:lon,id:id1,online:stt,dem:0});
    mang_infowindow.push({id:id1, wind: infow,stt:'Y'});
    infow.open(map);
    google.maps.event.addListener(infow,'closeclick',function(){
      document.getElementById("li_lo"+id1).remove();
      for (var i=0; i<mang_infowindow.length; i++){
        if(mang_infowindow[i].id == id1){
          mang_infowindow.splice(i,1);
          break;
        }
      }
      for (var k=0; k<mang_infowindow_main.length; k++){
        if(mang_infowindow_main[k].id == id1){
          mang_infowindow_main.splice(k,1);
          break;
        }
      }
  });
}
var check_123 = true;
function modify_name(id){
  if(mang_infowindow.length>0){
      if(mang_infowindow[mang_infowindow.length-1].stt=='N'){
        mang_infowindow[mang_infowindow.length-1].wind.close();
        mang_infowindow.splice(mang_infowindow.length-1, 1);
      }
  }
    mang_infowindow_main.forEach((tin)=>{
      if(tin.id == id){
        check_123 = true;
        document.getElementById("id_small_window").style.display="none";
        var id1 =  new Date().getTime();
        var infowindow = new google.maps.InfoWindow({position:{ lat:tin.lat, lng: tin.lon}});
          var noidung=  "<div class='info_wrap'><div>Input name of this place</div><input type='text' id='input_123' class='info_input'></input>"+
          "<div class='posname_2'><button onclick='cancle_luudiem("+id1+")' class='info_cancle'>CANCLE</button>"+
          "<button onclick='luudiem2("+tin.lat+","+tin.lon+","+id+")' class='info_ok'>OK</button></div></div>";
          infowindow.setContent(noidung);
          infowindow.open(map);
          var win = {id:id1, wind: infowindow, stt:'N'};
          mang_infowindow.push(win);
          return false;
      }
    });
}
function onmouse_pos(id,event){
  if(check_123){
      var w = window,
      d = document,
      e = d.documentElement,
      g = d.getElementsByTagName('body')[0],
      x1 = w.innerWidth || e.clientWidth || g.clientWidth,
      y1 = w.innerHeight|| e.clientHeight|| g.clientHeight;
    var x = event.clientX+5;
    var y = event.clientY+15;
    if(x> (x1-50))x=x-65;
    if(y> (y1-20))y=y-46;console.log('y:'+y);
    document.getElementById("id_small_window").style.left=x+"px";
    document.getElementById("id_small_window").style.top=y+"px";
    document.getElementById("id_small_window").style.display="block";
  }
  // if(x> (x1-50)){document.getElementById("id_small_window").style.right=x+"px";}
  // else {document.getElementById("id_small_window").style.left=x+"px";}
  // if(y> (y1-20)){document.getElementById("id_small_window").style.bottom=y+"px";}
  // else {document.getElementById("id_small_window").style.top=y+"px";}

}
function isOverflown(element) {
  return element.scrollHeight > element.clientHeight || element.scrollWidth > element.clientWidth;
}
function onmouse_out(){
  document.getElementById("id_small_window").style.display="none";
}
function fly_to(id){
  mang_infowindow.forEach((tin)=>{
    if(tin.id == id){
      if(tin.wind != null){
      var center = new google.maps.LatLng(tin.wind.getPosition().lat(),tin.wind.getPosition().lng());
       map.panTo(center);
       map.setZoom(18);
       return false;
     }
    }
  });
}
function handleChange(checkbox,id1){
    if(checkbox.checked == true){
      cancle_luudiem(id1);
    }else{
      for (var i=0; i<mang_infowindow_main.length; i++){
        if(mang_infowindow_main[i].id ==id1){
          var lat1 = mang_infowindow_main[i].lat;
          var lon1 = mang_infowindow_main[i].lon;
          var name1 = mang_infowindow_main[i].name;
          var infowindow = new google.maps.InfoWindow({
              position:{ lat:lat1, lng:lon1}
          });
            infowindow.setContent(name1);
            infowindow.open(map);
            var win = {id:id1, wind: infowindow};
            mang_infowindow.push(win);
            google.maps.event.addListener(infowindow, 'closeclick', function() {$("#"+id1).html("");});
        return false;
          }
        }
   }
}
function guitinnhan(){
    var sub = document.getElementById("id_input_subject").value.trim();
    if ( sub === ""){
    alert('There is no subjet.');
  }
    else {
    if (mang_contact_ok.length ==0){
      alert('There is no receiver.');
    }
    else {
      if (mang_infowindow_main.length == 0){
        alert('There is no position in map to send.');
      }
      else {
        var ma1 = Math.floor(Math.random()*(9000)+1000);
        var ma2 =Math.floor(Math.random()*(9000)+1000);
        mafull = ""+ma1+ma2;
        var tinnhanfull = {subject:sub,nguoinhan:mang_contact_ok, pos:mang_infowindow_main, id:mafull,imei:mafull};
        socket.emit('C_gui_tinnhan',tinnhanfull);
      }
    }
  }
}
function lưu_tinnhan(){

  // clearInterval(timer);
  var sub = document.getElementById("id_input_subject").value.trim();
    if ( sub === ""){alert('There is no subjet.');}
    else {if (mang_infowindow_main.length == 0){alert('There is no position in map to save.');}
      else {
        var ma1 = Math.floor(Math.random()*(9000)+1000);
        var ma2 =Math.floor(Math.random()*(9000)+1000);
        mafull = "22"+ma1+ma2;
        var tinnhanfull = {subject:sub,vitri:mang_infowindow_main, idc:mafull, imei:mafull};
        socket.emit('C_save_pos',tinnhanfull);
      }

  }
}
function open_close_list(){
  if(document.getElementById("id_btn_list").textContent === "List"){
    document.getElementById("id_right_bar").style.right = "0px";
      $("#id_btn_list").html("Hide");
  }
  else {
    document.getElementById("id_right_bar").style.right = "-250px";
      $("#id_btn_list").html("List");
  }
}
function myMap(){
      var mapOptions = {
      center: new google.maps.LatLng(41.5, -0.12),
      zoom: 10,
      // mapTypeId: google.maps.MapTypeId.HYBRID,
      scrollwheel: true,
      navigationControl: true,
      scaleControl: true,
      draggable: true,
      disableDoubleClickZoom: true,
      fullscreenControl: false,
      mapTypeControl:  false,
      rotateControl: true,

    }
      $(document).ready(function(){
          map = new google.maps.Map(document.getElementById("map"), mapOptions);
          map.setTilt(45);
          google.maps.event.addListener(map, "rightclick", function(event) {map_rightclick(event.latLng.lat(),event.latLng.lng()); });

      });
}
function map_rightclick( lat1, lon1){
  // xóa các info window hiện tại nếu nó đang mở
  if(mang_infowindow.length>0){
    if(mang_infowindow[mang_infowindow.length-1].stt=='N'){
      mang_infowindow[mang_infowindow.length-1].wind.close();
      mang_infowindow.splice(mang_infowindow.length-1, 1);
    }
  }
  var id =  new Date().getTime();
  var infowindow = new google.maps.InfoWindow({
      position:{ lat:lat1, lng: lon1}
    });
    var noidung=  "<div class='info_wrap'><div>Input name of this place</div><input type='text' id='input_123' class='info_input'></input>"+
    "<div class='posname_2'><button onclick='cancle_luudiem("+id+")' class='info_cancle'>CANCLE</button>"+
    "<button onclick='luudiem("+lat1+","+lon1+","+id+")' class='info_ok'>OK</button></div></div>";
    infowindow.setContent(noidung);
    infowindow.open(map);
    var win = {id:id, wind: infowindow, stt:'N'};
    mang_infowindow.push(win);
}
function luudiem2(lat1, lon1, id1){
  check_123 = true;
  var name1 = document.getElementById("input_123").value;
  let abc = 'pos'+id1;
  for (var i=0; i<mang_infowindow.length; i++){
    if(mang_infowindow[i].id ==id1){
      let chuoi;
      if(name1.length >5) {chuoi='<div align="center" id="'+abc+'" class="icon" onclick="modify_name('+id1+')" onmousemove="onmouse_pos('+id1+',event)" onmouseout="onmouse_out()">'+name1+'</div>';}
      else {
      chuoi='<div align="center" id="'+abc+'" class="icon2" onclick="modify_name('+id1+')" onmousemove="onmouse_pos('+id1+',event)" onmouseout="onmouse_out()">'+name1+'</div>';
      }
      mang_infowindow[i].wind.setContent(chuoi);
      mang_infowindow_main.forEach((tin)=>{if(tin.id==id1){tin.name = name1;return false;}});
      var line = "<div class='lo_list_sub' onclick='fly_to("+id1+")'>"+name1+"</div><input type='checkbox' class='list_line_checkbox' id='chk"+id1+"' onchange='hide_show_pos("+id1+")'><div class='lo_list_show'>Hide</div>";
      document.getElementById("li_lo"+id1).innerHTML =line;
      if(mang_infowindow.length>0){
          if(mang_infowindow[mang_infowindow.length-1].stt=='N'){
            mang_infowindow[mang_infowindow.length-1].wind.close();
            mang_infowindow.splice(mang_infowindow.length-1, 1);
          }
        }
      return false;
      }
    }
}
function luudiem(lat1, lon1, id1){
  check_123 = true;
  var name1 = document.getElementById("input_123").value;
  let abc = 'pos'+id1;
  for (var i=0; i<mang_infowindow.length; i++){
    if(mang_infowindow[i].id ==id1){
      let chuoi;
      if(name1.length >5) {chuoi= '<div align="center" id="'+abc+'" class="icon" id="'+id1+'" onclick="modify_name('+id1+')" onmousemove="onmouse_pos('+id1+',event)" onmouseout="onmouse_out()">'+name1+'</div>';}
      else {
        chuoi= '<div align="center" id="'+abc+'" class="icon2" id="'+id1+'" onclick="modify_name('+id1+')" onmousemove="onmouse_pos('+id1+',event)" onmouseout="onmouse_out()">'+name1+'</div>';
      }
      mang_infowindow[i].wind.setContent(chuoi);
      mang_infowindow[i].stt = 'Y';
      var diem2 = {name:name1, lat:lat1, lon:lon1, id:id1,online:'A',dem:0};
      mang_infowindow_main.push(diem2);
      var line = "<div class='list_line' id='li_lo"+id1+"'><div class='lo_list_sub' onclick='fly_to("+id1+")'>"+name1+"</div><input type='checkbox' class='list_line_checkbox' id='chk"+id1+"' onchange='hide_show_pos("+id1+")'><div class='lo_list_show'>Hide</div></div>";
      $("#id_location_list").append(line);
      google.maps.event.addListener(mang_infowindow[i].wind,'closeclick',function(){
        document.getElementById("li_lo"+id1).remove();
        for (var i=0; i<mang_infowindow.length; i++){
          if(mang_infowindow[i].id == id1){
            mang_infowindow.splice(i,1);
            break;
          }
        }
        for (var k=0; k<mang_infowindow_main.length; k++){
          if(mang_infowindow_main[k].id == id1){
            mang_infowindow_main.splice(k,1);
            break;
          }
        }
      });
      return false;
      }
    }
}
function cancle_luudiem(id){
  check_123 = true;
  for (var i=0; i<mang_infowindow.length; i++){
    if(mang_infowindow[i].id ==id){
    mang_infowindow[i].wind.close();
    mang_infowindow.splice(i, 1);
    return false;
      }
    }
  }
function show_time(time){
  let year = time.year;
  let month=time.month;
  let day = time.day;
  let hr = time.hr;
  let min = time.min;
  let sec = time.sec;
  let zone = time.time_zone;
  let day1 = new Date(year, month, day, hr, min, sec);
  let C_zone  = new Date().getTimezoneOffset();
  day1.setMinutes(day1.getMinutes()+zone - C_zone);
  return day1.getFullYear()+" "+(day1.getMonth()+1)+"/"+day1.getDate()+" "+day1.getHours()+":"+day1.getMinutes()+":"+day1.getSeconds();

}
function inbox_click(id,nam){
  // lấy cái id kia làm cái id tin nhắn client luôn
  socket.emit('C_reques_point_inbox',id);
  room_name_chose = nam;
  socket.off('S_pos_online');
  document.getElementById("id_online_text").style.display = "none";
  socket.on('S_send_point',(data)=>{
    $("#id_location_list").html("");
    $("#id_input_subject").val(room_name_chose);
    if(mang_infowindow.length > 0){
      mang_infowindow.forEach((win,key)=>{
      if(win.wind != null) {win.wind.close();}
      if(key === (mang_infowindow.length-1)){
        mang_infowindow=[];
        mang_infowindow_main=[];
        var bounds = new google.maps.LatLngBounds();
        data.forEach((tin,key1)=>{
          bounds.extend( new google.maps.LatLng(tin.lat, tin.lon));
          show_pos(tin.lat, tin.lon, strdecode(tin.name), tin.id,'A');
          var line = "<div class='list_line' id='li_lo"+tin.id+"'><div class='lo_list_sub' onclick='fly_to("+tin.id+")'>"+strdecode(tin.name)+"</div><input type='checkbox' class='list_line_checkbox' id='chk"+tin.id+"' onchange='hide_show_pos("+tin.id+")'><div class='lo_list_show'>Hide</div></div>";
          $("#id_location_list").append(line);
          if(key1==(data.length-1)){map.fitBounds(bounds);}
          });

        }
      });
    }
    else {
      var bounds = new google.maps.LatLngBounds();
      data.forEach((tin,key1)=>{
      show_pos(tin.lat, tin.lon, strdecode(tin.name),tin.id,'A');
      bounds.extend( new google.maps.LatLng(tin.lat, tin.lon));
      var line = "<div class='list_line' id='li_lo"+tin.id+"'><div class='lo_list_sub' onclick='fly_to("+tin.id+")'>"+strdecode(tin.name)+"</div><input type='checkbox' class='list_line_checkbox' id='chk"+tin.id+"' onchange='hide_show_pos("+tin.id+")'><div class='lo_list_show'>Hide</div></div>";
      $("#id_location_list").append(line);
      if(key1==(data.length-1)){map.fitBounds(bounds);}
    });
    }
    socket.off('S_send_point');
  });
}
function save_click(id,name){
  room_name_chose = name;
  document.getElementById("id_online_text").style.display = "none";
  socket.off('S_pos_online');
  socket.emit('C_reques_point',id);
  socket.on('S_send_point',(data)=>{

  $("#id_location_list").html("");
  $("#id_input_subject").val(room_name_chose);
  if(mang_infowindow.length > 0){
    mang_infowindow.forEach((win,key)=>{
          win.wind.close();
          if(key === (mang_infowindow.length-1)){
            var bounds = new google.maps.LatLngBounds();
            mang_infowindow = [];
            mang_infowindow_main=[];
            data.forEach((tin,key1)=>{
              show_pos(tin.lat, tin.lon, strdecode(tin.name), tin.id,'A');
              var line = "<div class='list_line' id='li_lo"+tin.id+"'><div class='lo_list_sub' onclick='fly_to("+tin.id+")'>"+strdecode(tin.name)+"</div><input type='checkbox' class='list_line_checkbox' id='chk"+tin.id+"' onchange='hide_show_pos("+tin.id+")'><div class='lo_list_show'>Hide</div></div>";
              $("#id_location_list").append(line);
              bounds.extend( new google.maps.LatLng(tin.lat, tin.lon));
              if(key1==(data.length-1)){map.fitBounds(bounds);}
              });
            }
          });
        }
        else {
          var bounds = new google.maps.LatLngBounds();
          data.forEach((tin,key1)=>{
          show_pos(tin.lat, tin.lon, strdecode(tin.name),tin.id,'A');
          var line = "<div class='list_line' id='li_lo"+tin.id+"'><div class='lo_list_sub' onclick='fly_to("+tin.id+")'>"+strdecode(tin.name)+"</div><input type='checkbox' class='list_line_checkbox' id='chk"+tin.id+"' onchange='hide_show_pos("+tin.id+")'><div class='lo_list_show'>Hide</div></div>";
          $("#id_location_list").append(line);
          bounds.extend( new google.maps.LatLng(tin.lat, tin.lon));
          if(key1==(data.length-1)){map.fitBounds(bounds);}
        });
        }
        socket.off('S_send_point');
  });
}
function send_click(id,name){
  room_name_chose = name;
  socket.off('S_pos_online');
  document.getElementById("id_online_text").style.display = "none";
  socket.emit('C_reques_point',id);
      socket.on('S_send_point',(data)=>{
        $("#id_location_list").html("");
        $("#id_input_subject").val(room_name_chose);
        if(mang_infowindow.length > 0){
          mang_infowindow.forEach((win,key)=>{
          win.wind.close();
          if(key === (mang_infowindow.length-1)){
            var bounds = new google.maps.LatLngBounds();
            mang_infowindow = [];
            mang_infowindow_main=[];
            data.forEach((tin,key1)=>{
              show_pos(tin.lat, tin.lon, strdecode(tin.name), tin.id,'A');
              var line = "<div class='list_line' id='li_lo"+tin.id+"'><div class='lo_list_sub' onclick='fly_to("+tin.id+")'>"+strdecode(tin.name)+"</div><input type='checkbox' class='list_line_checkbox' id='chk"+tin.id+"' onchange='hide_show_pos("+tin.id+")'><div class='lo_list_show'>Hide</div></div>";
              $("#id_location_list").append(line);
              bounds.extend( new google.maps.LatLng(tin.lat, tin.lon));
              if(key1==(data.length-1)){map.fitBounds(bounds);}
              });
            }
          });
        }
        else {
          var bounds = new google.maps.LatLngBounds();
          data.forEach((tin,key1)=>{
          show_pos(tin.lat, tin.lon, strdecode(tin.name),tin.id,'A');
          var line = "<div class='list_line' id='li_lo"+tin.id+"'><div class='lo_list_sub' onclick='fly_to("+tin.id+")'>"+strdecode(tin.name)+"</div><input type='checkbox' class='list_line_checkbox' id='chk"+tin.id+"' onchange='hide_show_pos("+tin.id+")'><div class='lo_list_show'>Hide</div></div>";
          $("#id_location_list").append(line);
          bounds.extend( new google.maps.LatLng(tin.lat, tin.lon));
          if(key1==(data.length-1)){map.fitBounds(bounds);}
        });
        }
        socket.off('S_send_point');
      });

}
function search_contact(){
  document.getElementById("id_list_contact").style.display = "none";
  $("#id_list_contact_search").html("");
  var chuoi = document.getElementById("id_input_contact").value.trim();
  if (chuoi.charAt(0)=='0'){chuoi = chuoi.substr(1);}
  if (chuoi.length>0){
    document.getElementById("id_list_contact_search").style.display = "block";
    var kiemtra = true;
    for (var i=0; i<mang_contact.length; i++){
      if  ( strdecode(mang_contact[i].name).toLowerCase().indexOf(chuoi.toLowerCase()) !== -1 || mang_contact[i].number.toLowerCase().indexOf(chuoi.toLowerCase()) !== -1){
        // var line = "<div class='list_contact_main_line'><div style='position:absolute;' id='list_contact_name'>"+strdecode(mang_contact[i].name)+"</div><div class='list_contact_line_number' id='list_contact_number'>"+mang_contact[i].number+"</div><button class='list_contact_line_btn' id='bt"+mang_contact[i].id+"' onclick='add_contact__search_click("+mang_contact[i].id+")'>"+document.getElementById("btn"+mang_contact[i].id).textContent+"</button></div>";
        var line = "<div class='list_contact_main_line'><div class='abc'><div class='list_contact_line_name' id='list_contact_name'>"+strdecode(mang_contact[i].name)+"</div><div class='list_contact_line_number' id='list_contact_number'>"+mang_contact[i].number+"</div><button class='list_contact_line_btn' id='bt"+mang_contact[i].id+"' onclick='add_contact__search_click("+mang_contact[i].id+")'>"+document.getElementById("btn"+mang_contact[i].id).textContent+"</button></div></div>";
          $("#id_list_contact_search").append(line);
          kiemtra = false;
        }
    }
      if (kiemtra){
          $("#id_list_contact_search").html("");
        // nếu không tìm thấy trong list contact hiện hữu thì sẽ tìm trên server
        // ten = "There is no item found in your listcontact. </br>Please input more letter to search in Global.";
        // $("#my_list_contact").html( ten);
        // var abc = ""+ten.length;
        // if (chuoi.trim().length >5){
        // socket.emit('W_check_contact',chuoi);
        // }
      }
  }
  else { document.getElementById("id_list_contact_search").style.display = "none";}
}
function add_contact__search_click(id){
  var x = document.getElementById("btn"+id).textContent;
  if(x === "Add"){
    mang_contact.forEach((row,key)=>{
      if(row.id == id){
        mang_contact_ok.push({id:id, name:strdecode(row.name), number:row.number});
        var line = "<div class='list_contact_ok_item' id='"+id+"'><div class='a111'>"+strdecode(row.name)+"</div><button class='a222' onclick='del_contact_ok("+id+")'>X</button></div>";
        $("#id_list_contact_ok").append(line);
        return false;
      }
    });
    $("#btn"+id).html("Move");
    $("#bt"+id).html("Move");
    if(document.getElementById("id_list_contact_ok").offsetHeight>document.getElementById("id_list_contact_ok").scrollHeight){
      document.getElementById("id_list_contact").style.top = "105px";
      document.getElementById("id_list_contact_search").style.top = "105px";
      document.getElementById("id_top_left_1").style.height = "100px";
    }
    else {
      document.getElementById("id_top_left_1").style.height = "85px";
      document.getElementById("id_list_contact").style.top = "90px";
      document.getElementById("id_list_contact_search").style.top = "90px";
    }

  }
  else {
    del_contact_ok(id);
    // $("#btn"+id).html("Add");
    $("#bt"+id).html("Add");
  }
}
function add_contact_click(id){
  var x = document.getElementById("btn"+id).textContent;
  if(x === "Add"){
    mang_contact.forEach((row,key)=>{
      if(row.id == id){
        mang_contact_ok.push({id:id, name:strdecode(row.name), number:row.number});
        var line = "<div class='list_contact_ok_item' id='"+id+"'><div class='a111'>"+strdecode(row.name)+"</div><button class='a222' onclick='del_contact_ok("+id+")'>X</button></div>";
        $("#id_list_contact_ok").append(line);


        return false;
      }
    });
    $("#btn"+id).html("Move");
    if(document.getElementById("id_list_contact_ok").offsetHeight>document.getElementById("id_list_contact_ok").scrollHeight){
      document.getElementById("id_list_contact").style.top = "105px";
      document.getElementById("id_list_contact_search").style.top = "105px";
      document.getElementById("id_top_left_1").style.height = "100px";
    }
    else {
      document.getElementById("id_top_left_1").style.height = "85px";
      document.getElementById("id_list_contact").style.top = "90px";
      document.getElementById("id_list_contact_search").style.top = "90px";
    }


  }
  else {
    del_contact_ok(id);
    // $("#btn"+id).html("Add");
      // console.log('hihi'+document.getElementById("id_list_contact_ok").innerHTML);

    // if (!document.getElementById("id_list_contact_ok").firstChild) {
    //   console.log('Đã có ha ha');
    //   document.getElementById("id_list_contact").style.top = "80px";
    // }

  }
}
function del_contact_ok(id){
  document.getElementById(id).remove();
  $("#btn"+id).html("Add");
   for(var i=mang_contact_ok.length-1; i >=0 ; i--){
     if(mang_contact_ok[i].id == id){
       mang_contact_ok.splice(i, 1);
       if (document.getElementById("id_list_contact_ok").innerHTML.trim() == '') {
         document.getElementById("id_top_left_1").style.height = "60px";
         document.getElementById("id_list_contact").style.top = "65px";
         document.getElementById("id_list_contact_search").style.top = "65px";
       }
       else {
         if(!(document.getElementById("id_list_contact_ok").offsetHeight>document.getElementById("id_list_contact_ok").scrollHeight)){
           document.getElementById("id_top_left_1").style.height = "85px";
           document.getElementById("id_list_contact").style.top = "90px";
           document.getElementById("id_list_contact_search").style.top = "90px";
         }
       }
       return false;
     }
   }


}
function xoadiem_inbox(){
  list_del_inbox = [];
  var list_checkbox = document.getElementsByClassName("line_inbox_chk");
    // $("#id_btn_send").html(list_checkbox[2].id);
  for (var i = 0; i < list_checkbox.length; i++) {
    if(list_checkbox[i].checked){
      mang_inbox.forEach((row1, key)=>{
        // nếu hàng đó có chọn thì sẽ lấy cái id của hàng đó, rồi tìm trong mảng, lấy cái id tin nhắn ra
        // đưa vào danh sách gửi đi.
        if(row1.id_pos==list_checkbox[i].id){
          list_del_inbox.push({idc:row1.id_tinnha_client});
          return false;
        }
        })
    }
    }
    if(list_del_inbox.length>0){
      var item="";
      if (list_del_inbox.length>1){item = "items";}else{item="item";}
      var r = confirm(list_del_inbox.length+" "+item+" will be deleted");
      if (r == true) {socket.emit("C_del_inbox",list_del_inbox); }
    }
}
function xoadiem_room(){
  list_del_online = [];
  var list_checkbox = document.getElementsByClassName("line_online_chk");
    // $("#id_btn_send").html(list_checkbox[2].id);
  for (var i = 0; i < list_checkbox.length; i++) {
    if(list_checkbox[i].checked){
      mang_room.forEach((row1, key)=>{
        if(row1.id_pos==list_checkbox[i].id){
          list_del_online.push({idc:row1.room_id});
          return false;
        }
        })
    }
    }
    if(list_del_online.length>0){
      var item="";
      if (list_del_online.length>1){item = "items";}else{item="item";}
      var r = confirm(list_del_online.length+" "+item+" will be deleted");
      if (r == true) {socket.emit("C_del_online",list_del_online);}
    }
}
function xoadiem_send(){
  list_del_send = [];
  var list_checkbox = document.getElementsByClassName("line_send_chk");
    // $("#id_btn_send").html(list_checkbox[2].id);
  for (var i = 0; i < list_checkbox.length; i++) {
    if(list_checkbox[i].checked){
      mang_send.forEach((row1, key)=>{
        // nếu hàng đó có chọn thì sẽ lấy cái id của hàng đó, rồi tìm trong mảng, lấy cái id tin nhắn ra
        // đưa vào danh sách gửi đi.
        if(row1.id_pos==list_checkbox[i].id){
          list_del_send.push({idc:row1.id_tinnha_client});
          return false;
        }
        })
    }
    }
    if(list_del_send.length>0){
      var item="";
      if (list_del_send.length>1){item = "items";}else{item="item";}
      var r = confirm(list_del_send.length+" "+item+" will be deleted");
      if (r == true) {socket.emit("C_del_send",list_del_send);}
    }
}
function checkbox_inbox_click(idc){
    var stt=0;
    var list_checkbox = document.getElementsByClassName("line_inbox_chk");
    for (var i = 0; i < list_checkbox.length; i++) {
      if(list_checkbox[i].checked){stt++;}
    }
    if(stt >0){
      document.getElementById("id_content_inbox_del").style.display = "block";
      if(stt>1) {$("#id_content_inbox_del_item").html(stt+" items were chosen");}
      else {$("#id_content_inbox_del_item").html(stt+" item was chosen");}
  }
    else {document.getElementById("id_content_inbox_del").style.display = "none";}

}
function checkbox_online_click(idc){
    var stt=0;
    var list_checkbox = document.getElementsByClassName("line_online_chk");
    for (var i = 0; i < list_checkbox.length; i++) {if(list_checkbox[i].checked){stt++;}}
    if(stt >0){
      document.getElementById("id_content_online_del").style.display = "block";
      if(stt>1) {$("#id_content_online_del_item").html(stt+" items were chosen");}
      else {$("#id_content_online_del_item").html(stt+" item was chosen");}
  }
    else {document.getElementById("id_content_online_del").style.display = "none";}

}
function checkbox_send_click(idc){
    var stt=0;
    var list_checkbox = document.getElementsByClassName("line_send_chk");
    for (var i = 0; i < list_checkbox.length; i++) {
      if(list_checkbox[i].checked){stt++;}
    }
    if(stt >0){
      document.getElementById("id_content_send_del").style.display = "block";
      if(stt>1) {$("#id_content_send_del_item").html(stt+" items were chosen");}
      else {$("#id_content_send_del_item").html(stt+" item was chosen");}
  }
    else {document.getElementById("id_content_send_del").style.display = "none";}

}
function checkbox_save_click(idc){
    var stt=0;
    var list_checkbox = document.getElementsByClassName("line_save_chk");
    for (var i = 0; i < list_checkbox.length; i++) {
      if(list_checkbox[i].checked){stt++;}
    }
    if(stt >0){
      document.getElementById("id_content_save_del").style.display = "block";
      if(stt>1) {$("#id_content_save_del_item").html(stt+" items were chosen");}
      else {$("#id_content_save_del_item").html(stt+" item was chosen");}
  }
    else {document.getElementById("id_content_save_del").style.display = "none";}

}
function show_contact_list(){
  if(document.getElementById("id_list_contact").style.display == "block"){
  document.getElementById("id_list_contact").style.display = "none";
  }
  else {
    // nếu mục chính contact không hiện, thì có 2 trường hợp: 1 là nó ẩn, và 2 là mục tìm kiếm đang hiện
      if(document.getElementById("id_list_contact_search").style.display == "block"){
        document.getElementById("id_list_contact_search").style.display = "none";
      }
      else {
        document.getElementById("id_list_contact").style.display = "block";
      }
  }
}
function show_content_top_right(id){
  document.getElementById(id).style.display = "block";
}
function add_form(name1,value1){
  var hiddenField = document.createElement("input");
  hiddenField.setAttribute("type", "hidden");
  hiddenField.setAttribute("name", name1);
  hiddenField.setAttribute("value", value1);
  form.appendChild(hiddenField);
}
function log_out(){
  add_form('out','OK');
  document.body.appendChild(form);
  form.submit();

  // socket.emit('C_leave_off');
  // socket.on('log_out_ok',()=>{
  //   ab = null;
  //   // localStorage.clear();
  // document.getElementById("id_list_contact_ok").innerHTML="";
  // // history.pushState(null, null, https://epos188.herokuapp.com);
  // // window.history.pushState(null, null, "/" + https://epos188.herokuapp.com);
  //    window.location.replace("https://epos188.herokuapp.com");
  //   // window.location.href = "https://epos188.herokuapp.com/";
  // });
}
window.onclick = function(event) {

  if (!event.target.matches('.btn_account')) {
    document.getElementById("id_content_account").style.display = "none";
  }
  if (!(event.target.matches('.btn_online')||(event.target.matches('.line_online_chk')  )  )  ) {
    document.getElementById("id_content_online").style.display = "none";
  }
  if (!(event.target.matches('.btn_save')||(event.target.matches('.line_save_chk')  )  )  ) {
    document.getElementById("id_content_save").style.display = "none";
  }
  if (!(event.target.matches('.btn_send')||(event.target.matches('.line_send_chk')  )  )  ) {
    document.getElementById("id_content_send").style.display = "none";
  }
  if (!(event.target.matches('.btn_inbox')||(event.target.matches('.line_inbox_chk')  )  )  ) {
    document.getElementById("id_content_inbox").style.display = "none";
  }
  if (!(event.target.matches('.list_contact_line_btn')||(event.target.matches('.list_contact_main_line')  )|| (event.target.matches('.btn_show_cont')  )||(event.target.matches('.list_contact_line_name')  )||(event.target.matches('.list_contact_line_number')  ) || (event.target.matches('.input_contact'))||(event.target.matches('.a222')) )  ) {
    document.getElementById("id_list_contact").style.display = "none";
    document.getElementById("id_list_contact_search").style.display = "none";

  }

}
</script>
</head>
<body>
  <div class="wrapper" id="id_wrapper">
    <div class="blue"></div>
    <div class="login">
        <div class="info_from_server" id ="my_info_from_server" align="center"></div>
        <div class="code_name"><font color="white">Country code</font></div>
        <select class="code_1 "name="code" id= "login_code_2">
           <option data-countryCode="DZ" value="213">Algeria (+213)</option>
           <option data-countryCode="AD" value="376">Andorra (+376)</option>
           <option data-countryCode="AO" value="244">Angola (+244)</option>
           <option data-countryCode="AI" value="1264">Anguilla (+1264)</option>
           <option data-countryCode="AG" value="1268">Antigua &amp; Barbuda (+1268)</option>
           <option data-countryCode="AR" value="54">Argentina (+54)</option>
           <option data-countryCode="AM" value="374">Armenia (+374)</option>
           <option data-countryCode="AW" value="297">Aruba (+297)</option>
           <option data-countryCode="AU" value="61">Australia (+61)</option>
           <option data-countryCode="AT" value="43">Austria (+43)</option>
           <option data-countryCode="AZ" value="994">Azerbaijan (+994)</option>
           <option data-countryCode="BS" value="1242">Bahamas (+1242)</option>
           <option data-countryCode="BH" value="973">Bahrain (+973)</option>
           <option data-countryCode="BD" value="880">Bangladesh (+880)</option>
           <option data-countryCode="BB" value="1246">Barbados (+1246)</option>
           <option data-countryCode="BY" value="375">Belarus (+375)</option>
           <option data-countryCode="BE" value="32">Belgium (+32)</option>
           <option data-countryCode="BZ" value="501">Belize (+501)</option>
           <option data-countryCode="BJ" value="229">Benin (+229)</option>
           <option data-countryCode="BM" value="1441">Bermuda (+1441)</option>
           <option data-countryCode="BT" value="975">Bhutan (+975)</option>
           <option data-countryCode="BO" value="591">Bolivia (+591)</option>
           <option data-countryCode="BA" value="387">Bosnia Herzegovina (+387)</option>
           <option data-countryCode="BW" value="267">Botswana (+267)</option>
           <option data-countryCode="BR" value="55">Brazil (+55)</option>
           <option data-countryCode="BN" value="673">Brunei (+673)</option>
           <option data-countryCode="BG" value="359">Bulgaria (+359)</option>
           <option data-countryCode="BF" value="226">Burkina Faso (+226)</option>
           <option data-countryCode="BI" value="257">Burundi (+257)</option>
           <option data-countryCode="KH" value="855">Cambodia (+855)</option>
           <option data-countryCode="CM" value="237">Cameroon (+237)</option>
           <option data-countryCode="CA" value="1">Canada (+1)</option>
           <option data-countryCode="CV" value="238">Cape Verde Islands (+238)</option>
           <option data-countryCode="KY" value="1345">Cayman Islands (+1345)</option>
           <option data-countryCode="CF" value="236">Central African Republic (+236)</option>
           <option data-countryCode="CL" value="56">Chile (+56)</option>
           <option data-countryCode="CN" value="86">China (+86)</option>
           <option data-countryCode="CO" value="57">Colombia (+57)</option>
           <option data-countryCode="KM" value="269">Comoros (+269)</option>
           <option data-countryCode="CG" value="242">Congo (+242)</option>
           <option data-countryCode="CK" value="682">Cook Islands (+682)</option>
           <option data-countryCode="CR" value="506">Costa Rica (+506)</option>
           <option data-countryCode="HR" value="385">Croatia (+385)</option>
           <option data-countryCode="CU" value="53">Cuba (+53)</option>
           <option data-countryCode="CY" value="90392">Cyprus North (+90392)</option>
           <option data-countryCode="CY" value="357">Cyprus South (+357)</option>
           <option data-countryCode="CZ" value="42">Czech Republic (+42)</option>
           <option data-countryCode="DK" value="45">Denmark (+45)</option>
           <option data-countryCode="DJ" value="253">Djibouti (+253)</option>
           <option data-countryCode="DM" value="1809">Dominica (+1809)</option>
           <option data-countryCode="DO" value="1809">Dominican Republic (+1809)</option>
           <option data-countryCode="EC" value="593">Ecuador (+593)</option>
           <option data-countryCode="EG" value="20">Egypt (+20)</option>
           <option data-countryCode="SV" value="503">El Salvador (+503)</option>
           <option data-countryCode="GQ" value="240">Equatorial Guinea (+240)</option>
           <option data-countryCode="ER" value="291">Eritrea (+291)</option>
           <option data-countryCode="EE" value="372">Estonia (+372)</option>
           <option data-countryCode="ET" value="251">Ethiopia (+251)</option>
           <option data-countryCode="FK" value="500">Falkland Islands (+500)</option>
           <option data-countryCode="FO" value="298">Faroe Islands (+298)</option>
           <option data-countryCode="FJ" value="679">Fiji (+679)</option>
           <option data-countryCode="FI" value="358">Finland (+358)</option>
           <option data-countryCode="FR" value="33">France (+33)</option>
           <option data-countryCode="GF" value="594">French Guiana (+594)</option>
           <option data-countryCode="PF" value="689">French Polynesia (+689)</option>
           <option data-countryCode="GA" value="241">Gabon (+241)</option>
           <option data-countryCode="GM" value="220">Gambia (+220)</option>
           <option data-countryCode="GE" value="7880">Georgia (+7880)</option>
           <option data-countryCode="DE" value="49">Germany (+49)</option>
           <option data-countryCode="GH" value="233">Ghana (+233)</option>
           <option data-countryCode="GI" value="350">Gibraltar (+350)</option>
           <option data-countryCode="GR" value="30">Greece (+30)</option>
           <option data-countryCode="GL" value="299">Greenland (+299)</option>
           <option data-countryCode="GD" value="1473">Grenada (+1473)</option>
           <option data-countryCode="GP" value="590">Guadeloupe (+590)</option>
           <option data-countryCode="GU" value="671">Guam (+671)</option>
           <option data-countryCode="GT" value="502">Guatemala (+502)</option>
           <option data-countryCode="GN" value="224">Guinea (+224)</option>
           <option data-countryCode="GW" value="245">Guinea - Bissau (+245)</option>
           <option data-countryCode="GY" value="592">Guyana (+592)</option>
           <option data-countryCode="HT" value="509">Haiti (+509)</option>
           <option data-countryCode="HN" value="504">Honduras (+504)</option>
           <option data-countryCode="HK" value="852">Hong Kong (+852)</option>
           <option data-countryCode="HU" value="36">Hungary (+36)</option>
           <option data-countryCode="IS" value="354">Iceland (+354)</option>
           <option data-countryCode="IN" value="91">India (+91)</option>
           <option data-countryCode="ID" value="62">Indonesia (+62)</option>
           <option data-countryCode="IR" value="98">Iran (+98)</option>
           <option data-countryCode="IQ" value="964">Iraq (+964)</option>
           <option data-countryCode="IE" value="353">Ireland (+353)</option>
           <option data-countryCode="IL" value="972">Israel (+972)</option>
           <option data-countryCode="IT" value="39">Italy (+39)</option>
           <option data-countryCode="JM" value="1876">Jamaica (+1876)</option>
           <option data-countryCode="JP" value="81">Japan (+81)</option>
           <option data-countryCode="JO" value="962">Jordan (+962)</option>
           <option data-countryCode="KZ" value="7">Kazakhstan (+7)</option>
           <option data-countryCode="KE" value="254">Kenya (+254)</option>
           <option data-countryCode="KI" value="686">Kiribati (+686)</option>
           <option data-countryCode="KP" value="850">Korea North (+850)</option>
           <option data-countryCode="KR" value="82">Korea South (+82)</option>
           <option data-countryCode="KW" value="965">Kuwait (+965)</option>
           <option data-countryCode="KG" value="996">Kyrgyzstan (+996)</option>
           <option data-countryCode="LA" value="856">Laos (+856)</option>
           <option data-countryCode="LV" value="371">Latvia (+371)</option>
           <option data-countryCode="LB" value="961">Lebanon (+961)</option>
           <option data-countryCode="LS" value="266">Lesotho (+266)</option>
           <option data-countryCode="LR" value="231">Liberia (+231)</option>
           <option data-countryCode="LY" value="218">Libya (+218)</option>
           <option data-countryCode="LI" value="417">Liechtenstein (+417)</option>
           <option data-countryCode="LT" value="370">Lithuania (+370)</option>
           <option data-countryCode="LU" value="352">Luxembourg (+352)</option>
           <option data-countryCode="MO" value="853">Macao (+853)</option>
           <option data-countryCode="MK" value="389">Macedonia (+389)</option>
           <option data-countryCode="MG" value="261">Madagascar (+261)</option>
           <option data-countryCode="MW" value="265">Malawi (+265)</option>
           <option data-countryCode="MY" value="60">Malaysia (+60)</option>
           <option data-countryCode="MV" value="960">Maldives (+960)</option>
           <option data-countryCode="ML" value="223">Mali (+223)</option>
           <option data-countryCode="MT" value="356">Malta (+356)</option>
           <option data-countryCode="MH" value="692">Marshall Islands (+692)</option>
           <option data-countryCode="MQ" value="596">Martinique (+596)</option>
           <option data-countryCode="MR" value="222">Mauritania (+222)</option>
           <option data-countryCode="YT" value="269">Mayotte (+269)</option>
           <option data-countryCode="MX" value="52">Mexico (+52)</option>
           <option data-countryCode="FM" value="691">Micronesia (+691)</option>
           <option data-countryCode="MD" value="373">Moldova (+373)</option>
           <option data-countryCode="MC" value="377">Monaco (+377)</option>
           <option data-countryCode="MN" value="976">Mongolia (+976)</option>
           <option data-countryCode="MS" value="1664">Montserrat (+1664)</option>
           <option data-countryCode="MA" value="212">Morocco (+212)</option>
           <option data-countryCode="MZ" value="258">Mozambique (+258)</option>
           <option data-countryCode="MN" value="95">Myanmar (+95)</option>
           <option data-countryCode="NA" value="264">Namibia (+264)</option>
           <option data-countryCode="NR" value="674">Nauru (+674)</option>
           <option data-countryCode="NP" value="977">Nepal (+977)</option>
           <option data-countryCode="NL" value="31">Netherlands (+31)</option>
           <option data-countryCode="NC" value="687">New Caledonia (+687)</option>
           <option data-countryCode="NZ" value="64">New Zealand (+64)</option>
           <option data-countryCode="NI" value="505">Nicaragua (+505)</option>
           <option data-countryCode="NE" value="227">Niger (+227)</option>
           <option data-countryCode="NG" value="234">Nigeria (+234)</option>
           <option data-countryCode="NU" value="683">Niue (+683)</option>
           <option data-countryCode="NF" value="672">Norfolk Islands (+672)</option>
           <option data-countryCode="NP" value="670">Northern Marianas (+670)</option>
           <option data-countryCode="NO" value="47">Norway (+47)</option>
           <option data-countryCode="OM" value="968">Oman (+968)</option>
           <option data-countryCode="PW" value="680">Palau (+680)</option>
           <option data-countryCode="PA" value="507">Panama (+507)</option>
           <option data-countryCode="PG" value="675">Papua New Guinea (+675)</option>
           <option data-countryCode="PY" value="595">Paraguay (+595)</option>
           <option data-countryCode="PE" value="51">Peru (+51)</option>
           <option data-countryCode="PH" value="63">Philippines (+63)</option>
           <option data-countryCode="PL" value="48">Poland (+48)</option>
           <option data-countryCode="PT" value="351">Portugal (+351)</option>
           <option data-countryCode="PR" value="1787">Puerto Rico (+1787)</option>
           <option data-countryCode="QA" value="974">Qatar (+974)</option>
           <option data-countryCode="RE" value="262">Reunion (+262)</option>
           <option data-countryCode="RO" value="40">Romania (+40)</option>
           <option data-countryCode="RU" value="7">Russia (+7)</option>
           <option data-countryCode="RW" value="250">Rwanda (+250)</option>
           <option data-countryCode="SM" value="378">San Marino (+378)</option>
           <option data-countryCode="ST" value="239">Sao Tome &amp; Principe (+239)</option>
           <option data-countryCode="SA" value="966">Saudi Arabia (+966)</option>
           <option data-countryCode="SN" value="221">Senegal (+221)</option>
           <option data-countryCode="CS" value="381">Serbia (+381)</option>
           <option data-countryCode="SC" value="248">Seychelles (+248)</option>
           <option data-countryCode="SL" value="232">Sierra Leone (+232)</option>
           <option data-countryCode="SG" value="65">Singapore (+65)</option>
           <option data-countryCode="SK" value="421">Slovak Republic (+421)</option>
           <option data-countryCode="SI" value="386">Slovenia (+386)</option>
           <option data-countryCode="SB" value="677">Solomon Islands (+677)</option>
           <option data-countryCode="SO" value="252">Somalia (+252)</option>
           <option data-countryCode="ZA" value="27">South Africa (+27)</option>
           <option data-countryCode="ES" value="34">Spain (+34)</option>
           <option data-countryCode="LK" value="94">Sri Lanka (+94)</option>
           <option data-countryCode="SH" value="290">St. Helena (+290)</option>
           <option data-countryCode="KN" value="1869">St. Kitts (+1869)</option>
           <option data-countryCode="SC" value="1758">St. Lucia (+1758)</option>
           <option data-countryCode="SD" value="249">Sudan (+249)</option>
           <option data-countryCode="SR" value="597">Suriname (+597)</option>
           <option data-countryCode="SZ" value="268">Swaziland (+268)</option>
           <option data-countryCode="SE" value="46">Sweden (+46)</option>
           <option data-countryCode="CH" value="41">Switzerland (+41)</option>
           <option data-countryCode="SI" value="963">Syria (+963)</option>
           <option data-countryCode="TW" value="886">Taiwan (+886)</option>
           <option data-countryCode="TJ" value="7">Tajikstan (+7)</option>
           <option data-countryCode="TH" value="66">Thailand (+66)</option>
           <option data-countryCode="TG" value="228">Togo (+228)</option>
           <option data-countryCode="TO" value="676">Tonga (+676)</option>
           <option data-countryCode="TT" value="1868">Trinidad &amp; Tobago (+1868)</option>
           <option data-countryCode="TN" value="216">Tunisia (+216)</option>
           <option data-countryCode="TR" value="90">Turkey (+90)</option>
           <option data-countryCode="TM" value="7">Turkmenistan (+7)</option>
           <option data-countryCode="TM" value="993">Turkmenistan (+993)</option>
           <option data-countryCode="TC" value="1649">Turks &amp; Caicos Islands (+1649)</option>
           <option data-countryCode="TV" value="688">Tuvalu (+688)</option>
           <option data-countryCode="UG" value="256">Uganda (+256)</option>
           <option data-countryCode="GB" value="44">UK (+44)</option>
           <option data-countryCode="UA" value="380">Ukraine (+380)</option>
           <option data-countryCode="AE" value="971">United Arab Emirates (+971)</option>
           <option data-countryCode="UY" value="598">Uruguay (+598)</option>
           <option data-countryCode="US" value="1">USA (+1)</option>
           <option data-countryCode="UZ" value="7">Uzbekistan (+7)</option>
           <option data-countryCode="VU" value="678">Vanuatu (+678)</option>
           <option data-countryCode="VA" value="379">Vatican City (+379)</option>
           <option data-countryCode="VE" value="58">Venezuela (+58)</option>
           <option data-countryCode="VN" value="84">Vietnam (+84)</option>
           <option data-countryCode="VG" value="84">Virgin Islands - British (+1284)</option>
           <option data-countryCode="VI" value="84">Virgin Islands - US (+1340)</option>
           <option data-countryCode="WF" value="681">Wallis &amp; Futuna (+681)</option>
           <option data-countryCode="YE" value="969">Yemen (North)(+969)</option>
           <option data-countryCode="YE" value="967">Yemen (South)(+967)</option>
           <option data-countryCode="ZM" value="260">Zambia (+260)</option>
           <option data-countryCode="ZW" value="263">Zimbabwe (+263)</option>
         </select>
        <div class="number_1"><font color="white">Number phone</font></div>
        <input class="number_2" type="text" name="number" value="" id= "login_number_2"></input>
        <div class="pass_1"><font color="white">Password</font></div>
        <input class="pass_2" type="password" name="pass" value="" id= "login_pass_2"></input>
        <button class="submit" onclick="login()">Đăng nhập</button>

    </div>
      <div class="top_right" id="id_top_right">
        <div class="top_right_item">
          <button class="btn_account" onclick="log_out()">LOG OUT</button>
          <div class="content_account" id="id_content_account"></div>
        </div>
        <div class="top_right_item">
          <button class="btn_online" onclick="show_content_top_right('id_content_online')">ONLINE</button>
          <div class="content_online" id="id_content_online">
            <div class="content_del" id="id_content_online_del"><div class="content_inbox_del_item" id="id_content_online_del_item"></div><button class="content_inbox_del_btn" onclick="xoadiem_room()">Del</button></div>
            <div style="height:1px; width:100px;" id="k_online"></div>
          </div>
        </div>
        <div class="top_right_item">
          <button class="btn_save" onclick="show_content_top_right('id_content_save')">SAVE</button>
          <div class="content_save" id="id_content_save">
            <div class="content_del" id="id_content_save_del"><div class="content_inbox_del_item" id="id_content_save_del_item"></div><button class="content_inbox_del_btn" onclick="xoadiem_save()">Del</button></div>
            <div style="height:1px; width:100px;" id="k_save"></div>
          </div>
        </div>
        <div class="top_right_item">
          <button class="btn_send" onclick="show_content_top_right('id_content_send')">SEND</button>
          <div class="content_send" id="id_content_send">
            <div class="content_del" id="id_content_send_del"><div class="content_inbox_del_item" id="id_content_send_del_item"></div><button class="content_inbox_del_btn" onclick="xoadiem_send()">Del</button></div>
            <div style="height:1px; width:100px;" id="k_send"></div>
          </div>
        </div>
        <div class="top_right_item">
          <button class="btn_inbox" onclick="show_content_top_right('id_content_inbox')">INBOX</button>
          <div class="content_inbox" id="id_content_inbox">
            <div class="content_del" id="id_content_inbox_del"><div class="content_inbox_del_item" id="id_content_inbox_del_item"></div><button class="content_inbox_del_btn" onclick="xoadiem_inbox()">Del</button></div>
            <div style="height:1px; width:100px;" id="k_inbox"></div>
          </div>
        </div>
      </div>
      <div class="top_left_1" id="id_top_left_1">
          <div class="input_sub_wrap"><input type="text" class="input_sub" autocomplete="off" placeholder="Subject" id="id_input_subject"></input></div>
          <div class="input_cont_wrap">
            <input type="text" class="input_contact" id="id_input_contact" placeholder="Search contact" oninput="search_contact()" autocomplete="off"></input>
            <button class="btn_show_cont" onclick="show_contact_list()"></button>
          </div>
          <button style="position:absolute;width:50px;height:25px;right:10px;top: 25px" id="id_btn_save" onclick="test()">SAVE</button>
          <button style="position:absolute;width:50px;height:25px;right:65px;top: 25px" id="id_btn_send" onclick="guitinnhan()">SEND</button>
          <div  class="online_text" id="id_online_text"><i><mark>online</mark></i></div>
          <div class="list_contact_ok" id="id_list_contact_ok"></div>
      </div>
      <div class="list_contact" id="id_list_contact"></div>
      <div class="list_contact" id="id_list_contact_search"></div>
      <div class="right_bar" id="id_right_bar">
        <button class="btn_list" onclick="open_close_list()" id="id_btn_list">List</button>
        <div class="location_list" id="id_location_list"></div>
      </div>
      <button class="bottom_right" onclick="kiemtra()" id="btn_sw_map">Satelite</button>
      <div id="map" class="class_map"></div>
      <div class="small_window" id="id_small_window">Modify</div>
      <!-- <audio src="" hidden></audio> -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTmmp8QAjy0E7SWlcrAFjRRTzGefS4lH0&callback=myMap" type="text/javascript"></script>
  </div>

  </body>
</html>
